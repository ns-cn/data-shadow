# DataShadow插件开发指南
- [首页](../README.md)
- [使用说明](使用说明.md)
- [自行构建](自行构建.md)
- [插件开发](插件开发.md)
  - [整体说明](#整体说明)
  - [数据源插件开发](#数据源插件开发)
  - [数据项比较器开发](#数据项比较器开发)

## 整体说明

DataShadow插件开发主要分为数据源插件开发和数据项比较器开发。通过引入sdk，基于sdk进行开发

```xml
<dependency>
    <groupId>com.tangyujun</groupId>
    <artifactId>datashadow-sdk</artifactId>
    <version>1.0.0</version>
</dependency>
```

## 数据源插件开发

通过加载注解了`@DataSourceRegistry`的`public static DataSourceGenerator generator()`方法,DataShadow会自动加载并注册数据源生成器。
相关代码:

```java
public class DataSourceCustom extends DataSource {
    /**
     * 数据源生成器
     * 
     * @return 数据源生成器
     */
    @DataSourceRegistry(friendlyName = "数据源名称")
    public static DataSourceGenerator generator(){
        return () -> new DataSourceCustom();
    }
    // 数据源其他方法实现
}
```

DataSource关键方法说明

| 方法名                                                                     | 说明                                                                                                         |
| -------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------ |
| `valid()`                                                                  | 验证数据源是否有效，验证内容包括文件是否存在且可读、数据库连接是否可用、数据格式是否正确、必要字段是否存在等 |
| `acquireValues()`                                                          | 获取数据集，从数据源读取原始数据并转换为统一的Map格式，处理数据类型转换                                      |
| `getColumns()`                                                             | 获取数据集的列名，返回数据源原始字段名称，用于显示数据源结构、配置字段映射关系、数据读取时的字段定位         |
| `getDescription()`                                                         | 获取已配置数据源的简单描述，用于在界面上显示数据源的基本信息，如mysql:127.0.0.1:3306/test                    |
| `configure(Window primaryStage, DataSourceConfigurationCallback callback)` | 配置数据源的具体行为，如打开对话框、选择文件、配置数据库连接信息等                                           |
| `exportSource()`                                                           | 将数据源对象序列化为字符串，用于序列化数据源配置信息，实现配置的导入导出功能                                 |
| `importSource(String exportValueString)`                                   | 将字符串反序列化为数据源对象，用于反序列化数据源配置信息，实现配置的导入功能                                 |


## 数据项比较器开发

通过加载注解了`@DataComparatorRegistry`的`public static DataComparatorGenerator method()`方法,DataShadow会自动加载并注册数据项比较器。

相关代码:

```java
public class StringDataComparator implements DataComparator {
    /**
     * 数据项比较器生成器
     * 
     * @return 数据项比较器生成器
     */
    @DataComparatorRegistry(friendlyName = "字符串", group = "System")
    public static DataComparatorGenerator generator(){
        return () -> new StringDataComparator();
    }
    // 数据项比较器其他方法实现
}
```
DataComparator关键方法说明

| 方法名                                       | 说明                         |
| -------------------------------------------- | ---------------------------- |
| `equals(Object o1, Object o2)`               | 比较两个数据项是否相等       |
| `config(Window primaryStage)`                | 详细配置数据比较器           |
| `exportComparator()`                         | 将数据比较器序列化为字符串   |
| `importComparator(String exportValueString)` | 将字符串反序列化为数据比较器 |
| `getDescription()`                           | 获取数据比较器的描述         |
